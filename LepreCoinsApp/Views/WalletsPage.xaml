<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="LepreCoinsApp.Views.WalletsPage"
             Title="ÐšÐ¾ÑˆÐµÐ»ÑŒÐºÐ¸"
             BackgroundColor="#0F1419">

    <Grid RowDefinitions="Auto,*" ColumnDefinitions="*" Padding="20">

        <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº -->
        <StackLayout Grid.Row="0" Spacing="10">
            <Label Text="ÐœÐ¾Ð¸ ÐšÐ¾ÑˆÐµÐ»ÑŒÐºÐ¸" FontSize="28" FontAttributes="Bold"/>
            <Label Text="Ð£Ð¿Ñ€Ð°Ð²Ð»ÑÐ¹Ñ‚Ðµ ÑÐ²Ð¾Ð¸Ð¼Ð¸ ÑÑ‡ÐµÑ‚Ð°Ð¼Ð¸" FontSize="14"/>
        </StackLayout>

        <!-- ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ðµ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ð¼Ð¾Ðµ -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Spacing="15" Padding="0,20,0,0">

                <!-- ÐžÐ±Ñ‰Ð¸Ð¹ Ð±Ð°Ð»Ð°Ð½Ñ -->
                <Frame BorderColor="#2ecc71" CornerRadius="10" Padding="20" HasShadow="True">
                    <VerticalStackLayout Spacing="10">
                        <Label Text="ÐžÐ±Ñ‰Ð¸Ð¹ Ð‘Ð°Ð»Ð°Ð½Ñ" FontSize="14" TextColor="#2ecc71"/>
                        <Label Text="{Binding TotalBalance, StringFormat='{0:C}'}" 
                               FontSize="32" FontAttributes="Bold" TextColor="#2ecc71"/>
                    </VerticalStackLayout>
                </Frame>

                <!-- ÐšÐ½Ð¾Ð¿ÐºÐ° Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ñ -->
                <Button Text="+ Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð½Ð¾Ð²Ñ‹Ð¹ ÐºÐ¾ÑˆÐµÐ»ÐµÐº" 
                        Command="{Binding AddWalletCommand}"
                        BackgroundColor="#3498db" 
                        TextColor="White" 
                        CornerRadius="8"/>

                <!-- Ð¡Ð¿Ð¸ÑÐ¾Ðº ÐºÐ¾ÑˆÐµÐ»ÑŒÐºÐ¾Ð² -->
                <Label Text="Ð’Ð°ÑˆÐ¸ ÐºÐ¾ÑˆÐµÐ»ÑŒÐºÐ¸" FontSize="16" FontAttributes="Bold" Margin="0,10,0,0"/>

                <CollectionView ItemsSource="{Binding Wallets}" 
                                SelectionMode="Single"
                                SelectionChangedCommand="{Binding SelectedWalletChangedCommand}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Frame CornerRadius="12" Padding="15" Margin="0,8" 
                                   BorderColor="#ddd" HasShadow="True">
                                <Grid RowDefinitions="Auto,Auto,Auto" ColumnDefinitions="*,Auto" ColumnSpacing="15" RowSpacing="8">

                                    <!-- ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð¸ Ð²Ð°Ð»ÑŽÑ‚Ð° -->
                                    <VerticalStackLayout Grid.Row="0" Grid.Column="0" Spacing="5">
                                        <Label Text="{Binding Name}" 
                                               FontSize="16" 
                                               FontAttributes="Bold"/>
                                        <Label Text="{Binding Currency}" 
                                               FontSize="12" 
                                               TextColor="#999"/>
                                    </VerticalStackLayout>

                                    <!-- Ð‘Ð°Ð»Ð°Ð½Ñ -->
                                    <Label Grid.Row="0" Grid.Column="1"
                                           Text="{Binding Balance, StringFormat='{0:C}'}" 
                                           FontSize="18" 
                                           FontAttributes="Bold"
                                           TextColor="#2ecc71"
                                           VerticalTextAlignment="Center"/>

                                    <!-- Ð Ð°Ð·Ð´ÐµÐ»Ð¸Ñ‚ÐµÐ»ÑŒ -->
                                    <BoxView Grid.Row="1" Grid.ColumnSpan="2" 
                                             Color="#ddd" 
                                             HeightRequest="1" 
                                             Margin="0,5,0,0"/>

                                    <!-- Ð”ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ -->
                                    <StackLayout Grid.Row="2" Grid.ColumnSpan="2" 
                                                 Orientation="Horizontal" 
                                                 Spacing="10">
                                        <Button Text="ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð±Ð°Ð»Ð°Ð½Ñ" 
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.UpdateWalletBalanceCommand}"
                                                CommandParameter="{Binding .}"
                                                BackgroundColor="#f39c12" 
                                                TextColor="White" 
                                                CornerRadius="6"
                                                Padding="8,4"
                                                FontSize="12"
                                                HorizontalOptions="FillAndExpand"/>

                                        <Button Text="Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ" 
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.DeleteWalletCommand}"
                                                CommandParameter="{Binding .}"
                                                BackgroundColor="#e74c3c" 
                                                TextColor="White" 
                                                CornerRadius="6"
                                                Padding="8,4"
                                                FontSize="12"
                                                HorizontalOptions="FillAndExpand"/>
                                    </StackLayout>

                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <!-- ÐŸÑƒÑÑ‚Ð¾Ðµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ -->
                <Frame IsVisible="{Binding Wallets}"
                       BorderColor="#ddd" CornerRadius="10" Padding="20" Margin="0,20,0,0">
                    <VerticalStackLayout Spacing="10" HorizontalOptions="Center">
                        <Label Text="ðŸ“­" FontSize="48" HorizontalOptions="Center"/>
                        <Label Text="ÐšÐ¾ÑˆÐµÐ»ÑŒÐºÐ¸" 
                               FontSize="16" 
                               FontAttributes="Bold"
                               HorizontalTextAlignment="Center"/>
                        <Label Text="Ð¢Ðµ Ð¼ÐµÑÑ‚Ð°, Ð³Ð´Ðµ Ð²Ð°ÑˆÐ¸ Ð´ÐµÐ½ÑŒÐ³Ð¸ Ñ‡ÑƒÐ²ÑÑ‚Ð²ÑƒÑŽÑ‚ ÑÐµÐ±Ñ ÑÐ¿Ð¾ÐºÐ¾Ð¹Ð½Ð¾" 
                               FontSize="12" 
                               TextColor="#999"
                               HorizontalTextAlignment="Center"
                               LineBreakMode="WordWrap"/>
                    </VerticalStackLayout>
                </Frame>

            </VerticalStackLayout>
        </ScrollView>

        <!-- POPUP: Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ ÐºÐ¾ÑˆÐµÐ»ÐµÐº -->
        <Grid IsVisible="{Binding IsAddWalletPopupVisible}"
              BackgroundColor="#80000000"
              Grid.RowSpan="2"
              ZIndex="100">

            <Frame BackgroundColor="White"
                   CornerRadius="18"
                   Padding="18"
                   WidthRequest="360"
                   HorizontalOptions="Center"
                   VerticalOptions="Center"
                   HasShadow="True">

                <VerticalStackLayout Spacing="12">

                    <Label Text="Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð½Ð¾Ð²Ñ‹Ð¹ ÐºÐ¾ÑˆÐµÐ»ÐµÐº"
                           FontSize="20"
                           FontAttributes="Bold"
                           Margin="0,0,0,6"/>

                    <Label Text="ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ ÐºÐ¾ÑˆÐµÐ»ÑŒÐºÐ°" FontSize="12" FontAttributes="Bold"/>
                    <Entry Text="{Binding WalletNameText}"
                           Placeholder="ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ ÑÑ‡ÐµÑ‚"/>

                    <Label Text="ÐÐ°Ñ‡Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð±Ð°Ð»Ð°Ð½Ñ" FontSize="12" FontAttributes="Bold"/>
                    <Entry Text="{Binding WalletInitialBalanceText}"
                           Keyboard="Numeric"
                           Placeholder="ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: 10000.00"/>

                    <Label Text="Ð’Ð°Ð»ÑŽÑ‚Ð°" FontSize="12" FontAttributes="Bold"/>
                    <Picker SelectedItem="{Binding WalletCurrency}"/>

                    <Label Text="{Binding WalletFormError}"
                           TextColor="#e74c3c"
                           IsVisible="{Binding HasWalletFormError}"
                           FontSize="12"/>

                    <Grid ColumnDefinitions="*,*" ColumnSpacing="10" Margin="0,8,0,0">
                        <Button Text="ÐžÑ‚Ð¼ÐµÐ½Ð°"
                                Grid.Column="0"
                                BackgroundColor="#999"
                                TextColor="White"
                                Command="{Binding CancelAddWalletCommand}"/>

                        <Button Text="Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ"
                                Grid.Column="1"
                                BackgroundColor="#2ecc71"
                                TextColor="White"
                                Command="{Binding SaveWalletCommand}"/>
                    </Grid>

                </VerticalStackLayout>
            </Frame>
        </Grid>

    </Grid>

</ContentPage>
