<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="LepreCoinsApp.Views.MainPage"
             Title="LepreCoins - Ð¡ÐµÐ¼ÐµÐ¹Ð½Ñ‹Ð¹ Ð‘ÑŽÐ´Ð¶ÐµÑ‚"
             BackgroundColor="#0F1419">

    <Grid RowDefinitions="Auto,*" ColumnDefinitions="*" Padding="20">

        <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº -->
        <StackLayout Grid.Row="0" Spacing="10">
            <Label Text="Ð¡ÐµÐ¼ÐµÐ¹Ð½Ñ‹Ð¹ Ð‘ÑŽÐ´Ð¶ÐµÑ‚" FontSize="28" FontAttributes="Bold" TextColor="White"/>
            <Label Text="Ð£Ð¿Ñ€Ð°Ð²Ð»ÑÐ¹Ñ‚Ðµ Ð±ÑŽÐ´Ð¶ÐµÑ‚Ð¾Ð¼ ÑÐµÐ¼ÑŒÐ¸ ÑÑ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ð¾" FontSize="14" TextColor="#ccc"/>
        </StackLayout>

        <!-- ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ðµ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ð¼Ð¾Ðµ -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Spacing="15" Padding="0,20,0,0">

                <!-- ÐšÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ° Ð¾Ð±Ñ‰ÐµÐ³Ð¾ Ð±Ð°Ð»Ð°Ð½ÑÐ° -->
                <Frame BorderColor="#ddd" CornerRadius="10" Padding="20" HasShadow="True" BackgroundColor="#1a1d21">
                    <VerticalStackLayout Spacing="10">
                        <Label Text="ÐžÐ±Ñ‰Ð¸Ð¹ Ð‘Ð°Ð»Ð°Ð½Ñ" FontSize="14" TextColor="#999"/>
                        <Label Text="{Binding TotalBalance, StringFormat='{0:C}'}" 
                               FontSize="32" FontAttributes="Bold" TextColor="#2ecc71"/>
                    </VerticalStackLayout>
                </Frame>

                <!-- Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° -->
                <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                    <Frame Grid.Column="0" BorderColor="#ddd" CornerRadius="10" Padding="15" HasShadow="True" BackgroundColor="#1a1d21">
                        <VerticalStackLayout Spacing="5">
                            <Label Text="Ð”Ð¾Ñ…Ð¾Ð´Ñ‹" FontSize="12" TextColor="#999"/>
                            <Label Text="{Binding MonthlyIncome, StringFormat='{0:C}'}" 
                                   FontSize="18" FontAttributes="Bold" TextColor="#3498db"/>
                        </VerticalStackLayout>
                    </Frame>

                    <Frame Grid.Column="1" BorderColor="#ddd" CornerRadius="10" Padding="15" HasShadow="True" BackgroundColor="#1a1d21">
                        <VerticalStackLayout Spacing="5">
                            <Label Text="Ð Ð°ÑÑ…Ð¾Ð´Ñ‹" FontSize="12" TextColor="#999"/>
                            <Label Text="{Binding MonthlyExpenses, StringFormat='{0:C}'}" 
                                   FontSize="18" FontAttributes="Bold" TextColor="#e74c3c"/>
                        </VerticalStackLayout>
                    </Frame>
                </Grid>

                <!-- Ð”ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ -->
                <Label Text="Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ" FontSize="16" FontAttributes="Bold" Margin="0,10,0,0" TextColor="White"/>

                <Button Text="+ Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ñ€Ð°ÑÑ…Ð¾Ð´" 
                        Command="{Binding AddExpenseCommand}"
                        BackgroundColor="#e74c3c" 
                        TextColor="White" 
                        CornerRadius="8"/>

                <Button Text="+ Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð´Ð¾Ñ…Ð¾Ð´" 
                        Command="{Binding AddIncomeCommand}"
                        BackgroundColor="#2ecc71" 
                        TextColor="White" 
                        CornerRadius="8"/>

                <Button Text="ðŸ“· Ð¡ÐºÐ°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ñ‡ÐµÐº"
                        Command="{Binding ScanReceiptCommand}"
                        BackgroundColor="#f39c12"
                        TextColor="White"
                        CornerRadius="8"/>

                <!-- ÐŸÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ -->
                <Label Text="ÐŸÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸" FontSize="16" FontAttributes="Bold" Margin="0,10,0,0" TextColor="White"/>

                <CollectionView ItemsSource="{Binding Transactions}" SelectionMode="Single">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Frame CornerRadius="8" Padding="15" Margin="0,5" BackgroundColor="#1a1d21" BorderColor="#333">
                                <Grid ColumnDefinitions="*,Auto" ColumnSpacing="15">
                                    <VerticalStackLayout Grid.Column="0" Spacing="3">
                                        <Label Text="{Binding Description}" FontSize="14" FontAttributes="Bold" TextColor="White"/>
                                        <Label Text="{Binding Date, StringFormat='{0:dd.MM.yyyy HH:mm}'}" 
                                               FontSize="12" TextColor="#999"/>
                                    </VerticalStackLayout>
                                    <Label Grid.Column="1" 
                                           Text="{Binding Amount, StringFormat='{0:C}'}" 
                                           FontSize="14" 
                                           FontAttributes="Bold"
                                           TextColor="{Binding Type, Converter={StaticResource TransactionTypeColorConverter}}"/>
                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

            </VerticalStackLayout>
        </ScrollView>

        <!-- POPUP OVERLAY -->
        <AbsoluteLayout Grid.Row="0" Grid.RowSpan="2" IsVisible="{Binding IsTransactionPopupVisible}" 
                        ZIndex="100"
                        BackgroundColor="Transparent"
                        InputTransparent="False">

            <!-- ÐŸÐ¾Ð»ÑƒÐ¿Ñ€Ð¾Ð·Ñ€Ð°Ñ‡Ð½Ñ‹Ð¹ Ñ„Ð¾Ð½ -->
            <BoxView Color="#80000000" 
                     AbsoluteLayout.LayoutBounds="0,0,1,1" 
                     AbsoluteLayout.LayoutFlags="All"/>

            <!-- ÐœÐ¾Ð´Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð¾ÐºÐ½Ð¾ -->
            <Frame BackgroundColor="#2a2d31"
                   CornerRadius="18"
                   Padding="18"
                   WidthRequest="500"
                   HasShadow="True"
                   BorderColor="#444"
                   AbsoluteLayout.LayoutBounds="0.5,0.5,-1,-1"
                   AbsoluteLayout.LayoutFlags="PositionProportional">

                <VerticalStackLayout Spacing="12">

                    <Label Text="{Binding TransactionPopupTitle}"
                           FontSize="20"
                           FontAttributes="Bold"
                           TextColor="White"
                           Margin="0,0,0,6"/>

                    <Label Text="Ð¡ÑƒÐ¼Ð¼Ð°" FontSize="12" FontAttributes="Bold" TextColor="#ccc"/>
                    <Entry Text="{Binding TransactionAmountText}"
                           Keyboard="Numeric"
                           Placeholder="ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: 1500.00"
                           BackgroundColor="#1e1f22"
                           TextColor="White"
                           PlaceholderColor="#666"
                           CornerRadius="6"
                           Padding="10"/>

                    <Label Text="ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ" FontSize="12" FontAttributes="Bold" TextColor="#ccc"/>
                    <Entry Text="{Binding TransactionDescription}"
                           Placeholder="ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: ÐŸÑ€Ð¾Ð´ÑƒÐºÑ‚Ñ‹ / Ð—Ð°Ñ€Ð¿Ð»Ð°Ñ‚Ð°"
                           BackgroundColor="#1e1f22"
                           TextColor="White"
                           PlaceholderColor="#666"
                           CornerRadius="6"
                           Padding="10"/>

                    <Label Text="ÐšÐ¾ÑˆÐµÐ»Ñ‘Ðº" FontSize="12" FontAttributes="Bold" TextColor="#ccc"/>
                    <Picker ItemsSource="{Binding Wallets}"
                            ItemDisplayBinding="{Binding Name}"
                            SelectedItem="{Binding SelectedWallet}"
                            BackgroundColor="#1e1f22"
                            TextColor="White"/>

                    <Label Text="ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ" FontSize="12" FontAttributes="Bold" TextColor="#ccc"/>
                    <Picker ItemsSource="{Binding Categories}"
                            ItemDisplayBinding="{Binding Title}"
                            SelectedItem="{Binding SelectedCategory}"
                            BackgroundColor="#1e1f22"
                            TextColor="White"/>

                    <!-- Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾Ð± Ð¾ÑˆÐ¸Ð±ÐºÐµ -->
                    <Label Text="{Binding TransactionFormError}"
                           TextColor="#ff6b6b"
                           IsVisible="{Binding HasTransactionFormError}"
                           FontSize="12"
                           Margin="0,5"/>

                    <!-- ÐšÐ½Ð¾Ð¿ÐºÐ¸ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹ -->
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="10" Margin="0,12,0,0">
                        <Button Grid.Column="0"
                                Text="ÐžÑ‚Ð¼ÐµÐ½Ð°"
                                Command="{Binding CancelTransactionCommand}"
                                BackgroundColor="#555"
                                TextColor="White"
                                CornerRadius="6"/>

                        <Button Grid.Column="1"
                                Text="Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ"
                                Command="{Binding SaveTransactionCommand}"
                                BackgroundColor="#2ecc71"
                                TextColor="White"
                                CornerRadius="6"/>
                    </Grid>

                </VerticalStackLayout>
            </Frame>
        </AbsoluteLayout>

    </Grid>

</ContentPage>
